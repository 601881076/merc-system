<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xhnj.mapper.TDeductionBatchQueryMapper">

    <resultMap id="BaseMap" type="com.xhnj.pojo.query.DeductionBatchQuery">
        <result property="id" column="id" />
        <result property="type" column="type" />
        <result property="isHold" column="is_hold" />
        <result property="systemType" column="system_type" />
        <result property="sourceType" column="source_type" />
        <result property="bankCode" column="bank_code" />
        <result property="batchNo" column="batch_no" />
        <result property="systemBatch" column="system_batch" />
        <result property="batchDesc" column="batch_desc" />
        <result property="totalTrans" column="total_trans" />
        <result property="totalAmt" column="total_amt" />
        <result property="status" column="status" />
        <result property="successTrans" column="success_trans" />
        <result property="failTrans" column="fail_trans" />
        <result property="processTrans" column="process_trans" />
        <result property="serialNo" column="serial_no" />
        <result property="retOwnSpec" column="ret_own_spec" />
        <result property="createTime" column="create_time" />
        <result property="updateTime" column="update_time" />
        <result property="contractNo" column="contract_no" />
        <collection property="batchCheck" ofType="com.xhnj.model.TBatchCheck">
            <result property="id" column="de_id" />
            <result property="batchId" column="batch_id" />
            <result property="status" column="chkStatus" />
            <result property="checkResult" column="check_result" />
            <result property="upUserId" column="up_user_id" />
            <result property="upUserName" column="up_user_name" />
            <result property="checkUserId" column="check_user_id" />
            <result property="checkUserName" column="check_user_name" />
            <result property="remark" column="de_pic" />
            <result property="checkTime" column="check_time" />
            <result property="createTime" column="chk_create_time" />

        </collection>
    </resultMap>


    <sql id="SqlList">
        batch.type,
        batch.is_hold,
        batch.system_type,
        batch.source_type,
        batch.bank_code,
        batch.batch_no,
        batch.system_batch,
        batch.batch_desc,
        batch.total_trans,
        Convert(decimal(15,2),batch.total_amt/100) AS "total_amt",
        batch.status,
        batch.success_trans,
        batch.fail_trans,
        batch.process_trans,
        batch.serial_no,
        batch.ret_own_spec,
        batch.create_time,
        batch.update_time,
        chk.status chkStatus,
        chk.check_result,
        chk.up_user_name,
        chk.check_user_id,
        chk.check_user_name,
        chk.check_time,
        chk.create_time chk_create_time
    </sql>


    <select id="listPage" resultMap="BaseMap">
        select
            <include refid="SqlList"/>
        from t_batch_no batch
        left join t_batch_check chk on batch.batch_no = chk.batch_no
        where 1 = 1
        <if test="dismissBatch.startTime != null and dismissBatch.startTime != ''">
            and CONVERT(varchar(100), batch.create_time, 23) <![CDATA[ >= ]]> CONVERT(varchar(100), #{dismissBatch.startTime}, 23)
        </if>
        <if test="dismissBatch.endTime != null and dismissBatch.endTime != ''">
            and CONVERT(varchar(100), batch.create_time, 23) <![CDATA[ <= ]]> CONVERT(varchar(100), #{dismissBatch.endTime}, 23)
        </if>
        <if test="dismissBatch.status!=null and dismissBatch.status!=''">
            and chk.status IN
            <foreach collection = "statusList" item = "status" open = "(" close = ")" separator = "," >
                #{status}
            </foreach>
        </if>
        <if test="dismissBatch.isAudit!=null and dismissBatch.isAudit!=''">
            and batch.status IN
            <foreach collection = "auditList" item = "audit" open = "(" close = ")" separator = "," >
                #{audit}
            </foreach>
        </if>
        <if test="dismissBatch.upUserName!=null and dismissBatch.upUserName!=''">
            and chk.up_user_name=#{dismissBatch.upUserName,jdbcType=VARCHAR}
        </if>
        <if test="dismissBatch.batchNo!=null and dismissBatch.batchNo!=''">
            and batch.batch_no=#{dismissBatch.batchNo,jdbcType=VARCHAR}
        </if>
        and batch.source_type='2'
        order by batch.create_time desc
    </select>

</mapper>