<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xhnj.mapper.TDeductionDetailMapper">
    <sql id="plaSql">
        id,
        batch_no,
        agreement_id,
        source_type,
        bank_code,
        order_no,
        pay_type,
        trade_time,
        pay_recv,
        currency,
        CONVERT(money/100, decimal(15,2)) AS "money",
        recv_account,
        recv_account_name,
        recv_bank_no,
        recv_bank_name,
        card_no,
        customer_name,
        pay_bank_no,
        pay_bank_name,
        usages,
        summary,
        postscript,
        create_time,
        reason,
        contract_no
    </sql>

    <select id="listPage" resultType="com.xhnj.model.TBatchDtl">
        SELECT
        <include refid="plaSql" />
        FROM t_batch_dtl
        WHERE 1=1
        <if test="tbatchDtl.startTime != null and tbatchDtl.startTime != ''">
            and date_format(create_time, '%Y-%m-%d') <![CDATA[ >= ]]> str_to_date(#{tbatchDtl.startTime,jdbcType=TIMESTAMP},'%Y-%m-%d')
        </if>
        <if test="tbatchDtl.endTime != null and tbatchDtl.endTime != ''">
            and date_format(create_time, '%Y-%m-%d') <![CDATA[ <= ]]> str_to_date(#{tbatchDtl.endTime,jdbcType=TIMESTAMP},'%Y-%m-%d')
        </if>
        <if test="tbatchDtl.status!=null and tbatchDtl.status!=''">
            and status=#{tbatchDtl.status,jdbcType=INTEGER}
        </if>
    </select>
</mapper>