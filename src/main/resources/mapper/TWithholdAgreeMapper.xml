<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xhnj.mapper.TWithholdAgreeMapper">

    <sql id="agreeSql">
        id,
        source_type,
        bank_code,
        bank_name,
        mobile_no,
        card_no,
        customer_name,
        cert_type,
        cert_no,
        status,
        reason,
        create_time
    </sql>

    <insert id="addBatch" parameterType="list">
        INSERT INTO t_withhold_agree
        (source_type,           deal_flag,                 bank_code,                bank_name,                 project_no,
        agreement_id,           bizserial_no,              mobile_no,                   card_no,                customer_name,
        cert_type,                cert_no,                     check_no,               send_no,                    own_spec
        )
        VALUES
        <foreach collection ="list" item="item" index= "index" separator =",">
            (
            #{item.sourceType, jdbcType=BIGINT},
            #{item.dealFlag, jdbcType=BIGINT},
            #{item.bankCode,jdbcType=VARCHAR},
            #{item.bankName,jdbcType=VARCHAR},
            #{item.projectNo,jdbcType=VARCHAR},
            #{item.agreementId,jdbcType=VARCHAR},
            #{item.bizserialNo,jdbcType=VARCHAR},
            #{item.mobileNo,jdbcType=VARCHAR},
            #{item.cardNo,jdbcType=VARCHAR},
            #{item.customerName,jdbcType=VARCHAR},
            #{item.certType,jdbcType=VARCHAR},
            #{item.certNo,jdbcType=VARCHAR},
            #{item.checkNo,jdbcType=VARCHAR},
            #{item.sendNo,jdbcType=VARCHAR},
            #{item.ownSpec,jdbcType=VARCHAR}
            )
        </foreach >
    </insert>

    <select id="listPageByBatchNo" resultType="com.xhnj.model.TWithholdAgree">
        SELECT
            <include refid="agreeSql" />
        FROM t_withhold_agree
        WHERE system_batch = #{batchNo,jdbcType=VARCHAR}
    </select>

    <select id="getByCardNo" resultType="com.xhnj.model.TWithholdAgree">
        SELECT
          source_type,
          status
        FROM t_withhold_agree
        WHERE card_no IN
        <foreach  collection="cardNoList" item="req" open="(" close=")" separator=" or ">
             #{req.cardNo,jdbcType=VARCHAR}
        </foreach>
        AND deal_flag = #{dealFlag,jdbcType=INTEGER}
    </select>

</mapper>